<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% extends 'base.html' %}
{% block content %}
<div class="experience-container" style="text-align: center; background-color:#eae7dc; 
object-fit: cover;
height: 100vh
background-position: center;
background-repeat:repeat-y;
background-size: cover;">
    <div class="experience-header" style="background-color:white;" >
        <img src="/static/images/asset1.png" style="width:50%;"></img>
        <h1 style="color:#e85a4f; font-weight:bold;"> Experience With HIV <h1>
    </div>
    {% if user.is_authenticated %}
        <div class="container d-flex flex-wrap flex-row justify-content-center" id= "card-container" style="
        display: flex;
        width:auto;
        gap: 10px;
        gap: 10px 20px;
        row-gap: 10px;
        column-gap: 20px;"> 
        </div>
        <button class= "btn-create" style="border-radius: 12px;"><a href="/experience/experience-form" style="font-size:13px; text-align:center;   text-decoration: none; margin-bottom:100px; color:white; font-weight: bold;
            ">Add Experience</a></button>
    {%else%}
        <h6> Login to add and view experience! </h4>
    {%endif%}
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script>
    function showJson(){
        $.get("/experience/json/", function(data){
            for(i = 0; i < data.length; i++){
                addText(data[i].fields.title, data[i].fields.experience, data[i].fields.date, data[i].fields.pk, data[i].fields.user)
            }
        })
    }

    $(document).ready(function(){
        showJson();
        makeCards();
    })

    function makeCards(){
        let text= "";
        $.ajax({
            url: "{% url 'Experience:show_experience_json' %}",
            type: "GET",
            dataType: "json",
            success: function(data){
                for(let experience of data){
                    text+= `<div class= "card-container flex-wrap m-2 p-2 " >
                        <div class="card-experience" style="min-width:350px; max-width:350px; padding:10px; margin:2px;">
                            <div class="card-content">
                                <h4 style="text-align:center; color: #e85a4f"><span class="card-title"> ${experience.fields.title}</span></h4>
                                <p> _____ <p>
                                <h6 id="experience-preview" class="text-truncate" style="text-align:center;"> ${experience.fields.experience} </h6>
                                <p style="font-size:10px; text-align:left;">by: ${experience.fields.username} </p>
                            </div>
                            <div class= "card-action" style="text-align:left;">
                                <a style="font-size:10px; text-align:left;  text-decoration: none; " href="experience-detail/${experience.pk}"> Read More </a>
                            </div>
                        </div>
                    </div>`

                }
                $('#card-container').html(text);
                $('#experience-preview').slice(0,20);


            } ,
            error: function(data){
                console.log('Error Detected');
            }
    })}
</script>
{% endblock content %}
